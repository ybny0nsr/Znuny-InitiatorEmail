name: Perl and SOPM Checks

on:
  push:
    branches: [ "main" ]        # Запускать при пуше в main
  pull_request:
    branches: [ "main" ]        # И при PR в main

jobs:
  checks:
    runs-on: ubuntu-latest      # Среда выполнения — Ubuntu

    steps:
      # 1. Забираем код из репозитория
      - name: Checkout repository
        uses: actions/checkout@v4

      # 2. Проверяем синтаксис всех Perl-модулей
      - name: Perl syntax check
        run: |
          echo "Checking Perl syntax..."
          # Находим все .pm файлы в Kernel и проверяем perl -c
          find Kernel -name '*.pm' -print0 | xargs -0 -n1 perl -c

      # 3. Проверяем, что все .sopm — корректный XML
      - name: Validate SOPM XML
        run: |
          echo "Validating SOPM files..."
          # Устанавливаем xmllint
          sudo apt-get update -qq
          sudo apt-get install -y libxml2-utils
          # Проверяем каждый .sopm в каталоге SOPM
          for file in SOPM/*.sopm; do
            echo "Checking $file"
            xmllint --noout "$file"
          done
